# Emoji 幸存者 - 忍者版 README

欢迎来到 Emoji 幸存者 - 忍者版！这是一款受 Vampire Survivors 启发的街机风格生存游戏。

## 游戏玩法

*   **控制:** 使用 `W`, `A`, `S`, `D` 键移动你的忍者角色。
*   **目标:** 在不断涌来的敌人攻击下尽可能长时间地生存下去。
*   **升级:** 消灭敌人会掉落经验宝石 (💎)。收集宝石以提升等级。
*   **强化:** 每次升级时，你可以从随机出现的选项中选择一项强化，包括获得新武器、新被动道具，或升级现有物品。
*   **胜利条件:** 游戏目前没有明确的胜利条件，目标是尽可能生存更长时间，击败更多的敌人和 Boss。
*   **失败条件:** 当你的生命值降至 0 时，游戏结束。
*   **暂停:** 按 `P` 键可以暂停或恢复游戏。

## 游戏机制

### 玩家

*   **属性:** 玩家拥有生命值、移动速度、护甲、生命恢复、拾取范围、伤害加成、射弹速度加成、冷却缩减加成、范围加成、持续时间加成、额外射弹数量等多项属性。基础属性定义在 `js/core/config.js` 的 `PLAYER_DEFAULT_STATS`。
*   **武器:** 玩家最多可以同时拥有 10 件武器 (可在 `config.js` 中修改 `maxWeapons`)。武器会自动攻击。
*   **被动道具:** 玩家最多可以同时拥有 10 件被动道具 (可在 `config.js` 中修改 `maxPassives`)。被动道具提供各种属性加成或特殊效果。
*   **升级:** 收集经验宝石提升等级，等级越高，升级所需经验越多 (经验曲线在 `config.js` 的 `LEVEL_XP_REQUIREMENTS` 中定义)。
*   **进化:** 当特定武器达到满级，并且玩家拥有指定的被动道具时，武器可能会进化成更强大的形态。进化逻辑在 `js/game.js` 的 `checkEvolution` 函数中处理。

### 武器 (Weapons)

*   **分类:** 基础武器、高级武器、进化武器。
*   **获取方式:** 初始自带1个匕首，其他武器通过升级获得。
*   **攻击方式:** 武器会自动根据其冷却时间进行攻击。具体攻击机制因武器而异（例如，匕首/岚刀/燃烧刀会追踪敌人，大蒜是持续光环，鞭子是固定方向抽击，握握手是范围爆炸）。
*   **升级效果:** 升级会提升武器的各种属性。**[待办]** 计划将所有武器的升级描述细化，确保描述能精确反映每次升级带来的具体属性变化（例如，伤害: 10 → 12, 冷却: 1.0s → 0.9s）。
*   **进化条件:** 特定武器达到满级（通常是 8 级），并且玩家拥有该武器指定的关联被动道具时，武器可能会进化成更强大的形态。进化后的武器通常拥有更强的属性和特殊效果。
*   **定义位置:** 基础武器在 `js/weapons/basicWeapons.js` 中定义，高级武器和进化武器（如果存在）在 `js/weapons/advancedWeapons.js` 中定义。

### 被动道具 (Passive Items)

*   **效果:** 提供各种属性加成（如最大生命值、伤害、速度、拾取范围、冷却缩减等）或特殊效果（如吸取经验、恢复生命、增加护甲等）。
*   **获取方式:** 通过升级获得。
*   **升级效果:** 通常是提升其提供的属性加成数值或增强特殊效果的效能（例如，增加生命恢复量、扩大磁铁吸附范围等）。**[待办]** 将对所有被动道具的升级描述与实际效果进行核对与校准。
    *   **特别关注:** `磁铁 (Magnet)` - 需要确认当前是否有残留的"15秒自动吸取经验"效果，如有则移除或调整。
*   **定义位置:** 被动道具在 `js/items/passiveItems.js` 中定义。

### 怪物 (Enemies)

*   **生成:** 敌人会从屏幕外生成（生成逻辑在 `js/game.js` 的 `enemyManager`），生成速度和数量会随着游戏时间推移而增加。
*   **类型:** 包含普通怪、快速怪、肉盾怪、远程怪、精英怪、自爆怪等。详细类型、出现时间、属性乘数、行为标记（如`isRanged`, `explodeOnDeath`）定义在 `js/constants.js` 的 `ENEMY_TYPES` 数组中。
*   **行为:** 大部分近战敌人会追击玩家。远程怪会在一定距离外射击玩家（逻辑在 `enemy.js` 的 `performRangedAttack`）。部分敌人有特殊行为，如死亡时自爆（`enemy.js` 的 `createExplosion`）。
*   **属性:** 基础敌人属性定义在 `js/core/config.js` 的 `ENEMY_BASE_STATS` 中。具体敌人的最终属性会结合 `ENEMY_TYPES` 中的乘数。游戏后期敌人强度会增加（目前主要通过生成更强的敌人类型实现）。
*   **掉落物:** 主要掉落经验宝石 (经验值基于敌人类型)。有小概率掉落恢复生命的心 (❤️) 或吸取经验的磁铁 (🧲)。掉落逻辑和概率在 `js/game.js` 的 `spawnRandomPickup` 函数中配置。

### Boss

*   **生成:** Boss 会按照 `js/core/config.js` 中 `BOSS_INTERVAL` 定义的时间间隔生成。生成前会有警告提示。
*   **类型与属性:** Boss 的类型（名称、Emoji、基础属性乘数、攻击模式等）在 `js/constants.js` 的 `BOSS_TYPES` 数组中定义。Boss 的实际属性（生命值、伤害等）会根据游戏时间（即这是第几个出现的 Boss）在 `js/entities/enemy.js` 的 `BossEnemy` 构造函数中进一步计算和提升。
*   **行为:** Boss 通常拥有普通攻击和特殊能力。普通攻击模式（如 `melee`, `ranged`, `aoe`, `summon`）和特殊能力（如地震 `performEarthquake`、弹幕 `performBarrage`、毒云 `performPoisonCloud`、精英召唤 `performEliteSummon`）的具体逻辑在 `js/entities/enemy.js` 的 `BossEnemy` 类中实现，根据 `BOSS_TYPES` 中为该 Boss 定义的 `attackPattern` 来选择执行。
*   **掉落物:** Boss 被击败后会掉落一个宝箱和大量经验宝石 (掉落逻辑在 `enemy.js` 的 `BossEnemy.onDeath` 方法)。**[待办]** Boss 宝箱当前似乎没有正确掉落，需要检查 `BossEnemy.onDeath` 中 `new Chest(...)` 是否被正确创建并添加到 `worldObjects` 数组。

### 升级系统 (Level Up)

*   **经验获取:** 通过收集敌人掉落的经验宝石 (💎)。宝石类型 `ExperienceGem` 在 `js/entities/pickups.js` 中定义。
*   **等级提升:** 当玩家累计经验达到当前等级所需经验值后升级。经验需求曲线定义在 `js/core/config.js` 的 `LEVEL_XP_REQUIREMENTS` 数组。
*   **升级选项:** 每次升级时，系统会生成若干升级选项供玩家选择。选项可能包括获取新的武器、新的被动道具，或升级已有的武器/被动。选项生成逻辑在 `js/game.js` 的 `getAvailableUpgrades` 函数中，会尝试确保总能提供武器相关的选项（如果还有武器槽位或可升级武器）。

### 掉落物 (Pickups)

*   **经验宝石 (💎):** 主要的升级资源。有大小两种，大宝石提供更多经验。拾取后增加玩家经验值。
*   **红心 (💖):** 拾取后恢复玩家一定生命值。
*   **磁铁 (🧲):** 拾取后将屏幕范围内的所有经验宝石吸引向玩家。**[待办]** 当前拾取磁铁后，经验宝石是立即增加给玩家，缺少一个飞向玩家的动态吸附过程。需要排查 `pickups.js` 中 `Magnet` 道具拾取逻辑以及 `ExperienceGem` 的 `isAttracted` 相关逻辑。
*   **宝箱 (🎁):** 由 Boss 掉落。**[待办]** 当前缺失。预期拾取后会提供多个随机的升级选项或奖励。

## 文件结构 (部分)

*   `index.html`: 游戏主页面，加载所有资源和脚本。
*   `js/core/config.js`: 核心配置文件 (游戏尺寸、基础属性、经验曲线、Boss间隔等)。
*   `js/constants.js`: 定义游戏常量 (Emoji、敌人类型、Boss类型等)。
*   `js/core/cameraManager.js`: 摄像机管理。
*   `js/game.js`: 游戏主逻辑文件 (初始化、游戏循环、更新、绘制、UI 管理、对象管理、升级逻辑等)。
*   `js/entities/`: 包含游戏中的各种实体类 (玩家 `player.js`、敌人 `enemy.js`、掉落物 `pickups.js`、伤害数字 `damageNumber.js` 等)。
*   `js/weapons/`: 包含武器基类 (`weapon.js`)、投射物基类 (`projectile.js`) 以及具体武器的定义 (`basicWeapons.js`, `advancedWeapons.js`)。
*   `js/items/`: 包含被动道具基类 (`passiveItem.js`) 和具体被动道具的定义 (`passiveItems.js`)。
*   `assets/`: 存放游戏资源，如图片 (`ninja.png`)。

## 如何修改

*   **基础数值/配置:** 查看 `js/core/config.js` 和 `js/constants.js`。
*   **游戏逻辑/核心循环/UI:** 查看 `js/game.js`。
*   **玩家/敌人行为/掉落物:** 查看 `js/entities/` 目录下的对应文件。
*   **武器/道具效果/升级逻辑:** 查看 `js/weapons/` 和 `js/items/` 目录下的对应文件。

## 待办事项与计划

*   **[待办] 细化所有升级描述:** 确保所有武器和被动道具的升级描述精确反映属性变化。
*   **[待办] 核对道具效果:** 全面检查武器和被动道具的实际效果是否与描述及设计意图一致，特别是磁铁的自动吸附功能。
*   **[待办] 修复磁铁吸附动画:** 实现或修复拾取磁铁后经验宝石飞向玩家的视觉效果。
*   **[待办] 修复Boss宝箱掉落:** 确保 Boss 被击败后能正确生成并掉落宝箱。
*   **[计划] 新增被动 - 舍利子回魂:**
    *   **效果:** 击杀敌人后，敌人有几率转化为幽灵状态。
    *   **幽灵特性:** 外观特殊、不攻击玩家、自动攻击其他敌人、持续一定时间、造成一定伤害。
    *   **升级方向:** 提升持续时间、伤害、最大数量、特殊效果（如转化精英/Boss、死亡爆炸等）。
*   **[计划] 增加更多武器/被动:** 根据反馈和创意添加更多有趣的游戏内容（例如激光武器等）。
*   **[计划] 优化数值平衡:** 根据游戏体验调整武器/敌人/升级曲线等数值。
*   **[计划] 完善宝箱机制:** 实现拾取宝箱后的奖励逻辑。

## 游戏特点

- 🥷 控制忍者角色，使用WASD或方向键移动
- 💀 与各种敌人战斗，包括普通敌人和强大的Boss
- 🔪 解锁和升级多种武器和被动物品，部分武器可进化
- ✨ 收集经验宝石升级你的角色
- 🎁 打开宝箱获得随机奖励 (待实现)
- 🏆 尽可能长时间生存，挑战自己的记录

## 如何运行

1. 克隆或下载此仓库
2. 使用现代浏览器（如Chrome、Firefox、Edge等）打开`index.html`文件
3. 点击"开始游戏"按钮开始游戏

## 游戏控制

- **WASD** 或 **方向键**: 移动角色
- **P**: 暂停/继续游戏

## 技术细节

游戏使用纯JavaScript和HTML5 Canvas构建，无需任何外部库或框架。主要特点包括：

- 面向对象的游戏设计
- 使用对象池管理投射物和伤害数字以提高性能
- 平滑的摄像机跟随
- 响应式设计，适应不同屏幕尺寸
- 使用表情符号作为游戏精灵，辅以少量图片资源

## 许可证

MIT